---
import { useTranslations, languages, getLocalizedPath, type Language } from '../../i18n';
import { contactInfo } from '../../data/contact';

interface Props {
  lang: Language;
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const navItems = [
  { href: '/', label: t('nav.home') },
  { href: '/about', label: t('nav.about') },
  { href: '/services', label: t('nav.services') },
  { href: '/gallery', label: t('nav.gallery') },
  { href: '/awards', label: t('nav.awards') },
  { href: '/podcast', label: t('nav.podcast') },
  { href: '/contact', label: t('nav.contact') }
];
---

<header class="fixed top-0 left-0 right-0 z-50 transition-all duration-300" id="main-header">
  <nav class="glass-dark py-4">
    <div class="container-custom flex items-center justify-between">
      <!-- Logo -->
      <a href={getLocalizedPath('/', lang)} class="flex items-center gap-3 group" transition:name="logo">
        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-gold-400 to-gold-600 flex items-center justify-center text-white font-bold text-xl shadow-lg group-hover:scale-110 transition-transform">
          рдк
        </div>
        <div class="hidden sm:block">
          <span class="text-white font-bold text-xl">{t('hero.brand')}</span>
          <span class="block text-gold-400 text-xs -mt-1">Parivartan</span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8">
        {navItems.map((item) => (
          <a
            href={getLocalizedPath(item.href, lang)}
            class="text-white/90 hover:text-gold-400 font-medium transition-colors link-underline"
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Right Section -->
      <div class="flex items-center gap-4">
        <!-- Language Switcher -->
        <div class="relative group">
          <button class="flex items-center gap-2 text-white/90 hover:text-gold-400 transition-colors px-3 py-2 rounded-lg hover:bg-white/10">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/>
            </svg>
            <span class="text-sm font-medium">{languages[lang]}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <!-- Dropdown -->
          <div class="absolute right-0 top-full mt-2 py-2 bg-navy-600 rounded-xl shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 min-w-32">
            {Object.entries(languages).map(([code, name]) => (
              <a
                href={getLocalizedPath(Astro.url.pathname, code as Language)}
                class={`block px-4 py-2 text-sm transition-colors ${
                  code === lang
                    ? 'text-gold-400 bg-white/10'
                    : 'text-white/90 hover:text-gold-400 hover:bg-white/5'
                }`}
              >
                {name}
              </a>
            ))}
          </div>
        </div>

        <!-- CTA Button -->
        <a
          href={`https://wa.me/${contactInfo.whatsapp}`}
          target="_blank"
          rel="noopener noreferrer"
          class="hidden md:flex btn-gold text-sm"
        >
          {t('hero.cta_primary')}
        </a>

        <!-- Mobile Menu Button -->
        <button
          class="lg:hidden text-white p-2 hover:bg-white/10 rounded-lg transition-colors"
          id="mobile-menu-btn"
          aria-label="Toggle menu"
        >
          <svg class="w-6 h-6 menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
          <svg class="w-6 h-6 close-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div class="lg:hidden hidden bg-navy-600/95 backdrop-blur-lg" id="mobile-menu">
    <div class="container-custom py-6 space-y-4">
      {navItems.map((item) => (
        <a
          href={getLocalizedPath(item.href, lang)}
          class="block text-white/90 hover:text-gold-400 font-medium py-2 transition-colors"
        >
          {item.label}
        </a>
      ))}

      <div class="pt-4 border-t border-white/10">
        <p class="text-white/60 text-sm mb-3">Select Language</p>
        <div class="flex gap-2">
          {Object.entries(languages).map(([code, name]) => (
            <a
              href={getLocalizedPath(Astro.url.pathname, code as Language)}
              class={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                code === lang
                  ? 'bg-gold-500 text-white'
                  : 'bg-white/10 text-white/90 hover:bg-white/20'
              }`}
            >
              {name}
            </a>
          ))}
        </div>
      </div>

      <a
        href={`https://wa.me/${contactInfo.whatsapp}`}
        target="_blank"
        rel="noopener noreferrer"
        class="block btn-gold text-center mt-4"
      >
        {t('hero.cta_primary')}
      </a>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-20"></div>

<script>
  function initMobileMenu() {
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = menuBtn?.querySelector('.menu-icon');
    const closeIcon = menuBtn?.querySelector('.close-icon');

    menuBtn?.addEventListener('click', () => {
      const isOpen = mobileMenu?.classList.toggle('hidden');
      menuIcon?.classList.toggle('hidden');
      closeIcon?.classList.toggle('hidden');
      document.body.classList.toggle('mobile-menu-open', !isOpen);
    });

    // Close menu on link click
    mobileMenu?.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        mobileMenu.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        document.body.classList.remove('mobile-menu-open');
      });
    });
  }

  function initHeaderScroll() {
    const header = document.getElementById('main-header');
    let lastScroll = 0;

    window.addEventListener('scroll', () => {
      const currentScroll = window.scrollY;

      if (currentScroll > 100) {
        header?.classList.add('shadow-lg');
      } else {
        header?.classList.remove('shadow-lg');
      }

      lastScroll = currentScroll;
    });
  }

  initMobileMenu();
  initHeaderScroll();

  document.addEventListener('astro:after-swap', () => {
    initMobileMenu();
    initHeaderScroll();
  });
</script>
